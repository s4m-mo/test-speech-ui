<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Speech</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the app */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        /* Gradient border button style */
        .gradient-border-button {
            background: linear-gradient(to right, #1f2937, #1f2937) padding-box,
                        linear-gradient(to right, #ef4444, #f59e0b) border-box;
            border: 2px solid transparent;
            color: white;
            transition: all 0.3s ease;
        }
        .gradient-border-button:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .preset-item {
             /* Added transition for smooth reordering */
             transition: all 0.2s ease-in-out;
        }

        .preset-item:active {
            transform: scale(0.98);
            background-color: #374151;
        }

        /* Style for when an item is being dragged */
        .dragging {
            opacity: 0.5;
            background-color: #374151;
        }

        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex flex-col h-full overflow-hidden">

    <!-- Header for Voice Selection -->
    <header class="p-4 bg-gray-900/80 backdrop-blur-sm border-b border-gray-700 w-full z-20">
        <label for="voiceSelect" class="block mb-2 text-sm font-medium text-gray-400">Select Voice:</label>
        <select id="voiceSelect" class="w-full bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-red-500 focus:border-red-500 block p-2.5">
            <!-- Voice options will be populated by JavaScript -->
        </select>
    </header>

    <!-- Main content for preset list -->
    <main id="presetsContainer" class="flex-grow overflow-y-auto p-4 pb-28">
        <div id="presetsList" class="space-y-3">
            <!-- Preset items will be populated by JavaScript -->
            <p id="noPresetsMessage" class="text-center text-gray-500 mt-8">No presets added yet. Use the "Add" button below to create one.</p>
        </div>
    </main>

    <!-- Modal for adding/editing presets -->
    <div id="inputModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-sm border border-gray-700">
            <div class="p-5">
                <h2 id="modalTitle" class="text-lg font-bold text-center mb-4">Modal Title</h2>
                <input type="text" id="textInput" class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg p-3 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition" placeholder="Enter text here...">
            </div>
            <div class="grid grid-cols-2 gap-px bg-gray-700 rounded-b-xl overflow-hidden">
                <button id="cancelButton" class="bg-gray-800 hover:bg-gray-700 text-gray-300 py-3 font-semibold transition">Cancel</button>
                <button id="submitButton" class="bg-gray-800 hover:bg-gray-700 text-yellow-400 py-3 font-semibold transition">Submit</button>
            </div>
        </div>
    </div>

    <!-- Pinned Bottom Navigation -->
    <footer class="fixed bottom-0 left-0 right-0 bg-gray-900/80 backdrop-blur-sm border-t border-gray-700 z-20">
        <div class="flex items-center gap-3 p-3 max-w-lg mx-auto">
            <input type="text" id="typeInput" class="flex-grow w-full bg-gray-800 border border-gray-600 text-white rounded-full p-3 pl-5 focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition" placeholder="Type and press Enter to speak...">
            <button id="addButton" class="gradient-border-button font-bold py-3 px-5 rounded-full shadow-lg flex-shrink-0">
                Add
            </button>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM element references
            const voiceSelect = document.getElementById('voiceSelect');
            const presetsList = document.getElementById('presetsList');
            const noPresetsMessage = document.getElementById('noPresetsMessage');
            const addButton = document.getElementById('addButton');
            const typeInput = document.getElementById('typeInput');
            const inputModal = document.getElementById('inputModal');
            const modalTitle = document.getElementById('modalTitle');
            const textInput = document.getElementById('textInput');
            const cancelButton = document.getElementById('cancelButton');
            const submitButton = document.getElementById('submitButton');

            // App state
            let voices = [];
            let presets = JSON.parse(localStorage.getItem('tts_presets')) || [];
            let currentAction = null; // Can be 'add' or 'edit'
            let editingIndex = null; // To track which preset is being edited
            let draggedItem = null; // To track the element being dragged

            // --- Core Speech Synthesis Functions ---
            function populateVoiceList() {
                voices = speechSynthesis.getVoices();
                voiceSelect.innerHTML = ''; 
                if (voices.length === 0) {
                    const option = document.createElement('option');
                    option.textContent = 'No voices available';
                    voiceSelect.appendChild(option);
                    return;
                }
                voices.forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.textContent = `${voice.name} (${voice.lang})`;
                    option.value = index;
                    voiceSelect.appendChild(option);
                });
            }

            function speak(text) {
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                }
                if (text.trim() !== '') {
                    const utterance = new SpeechSynthesisUtterance(text);
                    const selectedVoiceIndex = voiceSelect.value;
                    if (voices[selectedVoiceIndex]) {
                        utterance.voice = voices[selectedVoiceIndex];
                    }
                    speechSynthesis.speak(utterance);
                }
            }

            // --- UI Rendering ---

            function savePresets() {
                localStorage.setItem('tts_presets', JSON.stringify(presets));
            }

            function renderPresets() {
                presetsList.innerHTML = '';
                if (presets.length === 0) {
                    presetsList.appendChild(noPresetsMessage);
                    noPresetsMessage.style.display = 'block';
                } else {
                    noPresetsMessage.style.display = 'none';
                    presets.forEach((presetText, index) => {
                        const presetDiv = document.createElement('div');
                        presetDiv.className = 'preset-item bg-gray-800 p-2 pl-4 rounded-lg flex justify-between items-center';
                        presetDiv.setAttribute('draggable', true);
                        presetDiv.dataset.index = index;

                        const textSpan = document.createElement('span');
                        textSpan.textContent = presetText;
                        textSpan.className = 'flex-grow cursor-pointer';
                        textSpan.onclick = () => speak(presetText);
                        
                        const buttonsContainer = document.createElement('div');
                        buttonsContainer.className = 'flex items-center flex-shrink-0';
                        
                        // Edit Button
                        const editButton = document.createElement('button');
                        editButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>`;
                        editButton.className = 'p-2 text-gray-500 hover:text-yellow-400 focus:outline-none transition-colors';
                        editButton.onclick = (e) => { e.stopPropagation(); showModal('edit', 'Edit Preset', presetText, index); };

                        // Delete Button
                        const deleteButton = document.createElement('button');
                        deleteButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>`;
                        deleteButton.className = 'p-2 text-gray-500 hover:text-red-400 focus:outline-none transition-colors';
                        deleteButton.onclick = (e) => { e.stopPropagation(); presets.splice(index, 1); savePresets(); renderPresets(); };
                        
                        // Drag Handle
                        const dragHandle = document.createElement('div');
                        dragHandle.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>`;
                        dragHandle.className = 'p-2 text-gray-500 cursor-move';

                        buttonsContainer.appendChild(editButton);
                        buttonsContainer.appendChild(deleteButton);
                        buttonsContainer.appendChild(dragHandle);
                        
                        presetDiv.appendChild(textSpan);
                        presetDiv.appendChild(buttonsContainer);

                        presetsList.appendChild(presetDiv);
                    });
                }
            }

            // --- Modal Handling ---
            function showModal(action, title, value = '', index = null) {
                currentAction = action;
                editingIndex = index;
                modalTitle.textContent = title;
                textInput.value = value;
                inputModal.classList.remove('hidden');
                setTimeout(() => textInput.focus(), 100);
            }

            function hideModal() {
                inputModal.classList.add('hidden');
                currentAction = null;
                editingIndex = null;
            }

            function handleSubmit() {
                const text = textInput.value.trim();
                if (text) {
                    if (currentAction === 'add') {
                        presets.push(text);
                    } else if (currentAction === 'edit' && editingIndex !== null) {
                        presets[editingIndex] = text;
                    }
                    savePresets();
                    renderPresets();
                }
                hideModal();
            }

            // --- Event Listeners ---
            populateVoiceList();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = populateVoiceList;
            }
            renderPresets();

            // --- Delegated Drag and Drop Event Listeners on the list container ---
            presetsList.addEventListener('dragstart', e => {
                const target = e.target.closest('.preset-item');
                if (target) {
                    draggedItem = target;
                    // Use a short timeout to allow the browser to create the drag image
                    setTimeout(() => {
                        draggedItem.classList.add('dragging');
                    }, 0);
                }
            });

            presetsList.addEventListener('dragend', () => {
                if (draggedItem) {
                    draggedItem.classList.remove('dragging');
                    draggedItem = null;
                }
            });

            presetsList.addEventListener('dragover', e => {
                e.preventDefault(); // Necessary to allow dropping
                if (!draggedItem) return;

                const overElement = e.target.closest('.preset-item');
                if (!overElement || overElement === draggedItem) return;

                const rect = overElement.getBoundingClientRect();
                // Check if the cursor is in the top half or bottom half of the item being hovered over
                const offsetY = e.clientY - rect.top - rect.height / 2;

                if (offsetY < 0) {
                    // Insert before the hovered element
                    presetsList.insertBefore(draggedItem, overElement);
                } else {
                    // Insert after the hovered element
                    presetsList.insertBefore(draggedItem, overElement.nextSibling);
                }
            });

            presetsList.addEventListener('drop', e => {
                e.preventDefault();
                if (!draggedItem) return;
                
                // The visual reorder is done, now we sync the data array
                const newOrderedElements = [...presetsList.querySelectorAll('.preset-item')];
                const newPresets = newOrderedElements.map(item => item.querySelector('span').textContent);

                presets = newPresets;
                savePresets();
                // Re-render to normalize state and ensure event listeners have correct indexes
                renderPresets();
            });


            addButton.addEventListener('click', () => {
                showModal('add', 'Add New Preset', '');
            });

            typeInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    const text = typeInput.value.trim();
                    if (text) {
                        speak(text);
                        typeInput.value = '';
                    }
                }
            });
            
            cancelButton.addEventListener('click', hideModal);
            submitButton.addEventListener('click', handleSubmit);

            textInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') handleSubmit();
            });
            
            inputModal.addEventListener('click', (e) => {
                if (e.target === inputModal) hideModal();
            });
        });
    </script>
</body>
</html>


